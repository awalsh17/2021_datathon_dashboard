# Load pkgs ----

# xfun::pkg_attach(
#     "shiny", "shinyWidgets", "shinydashboard", "shinydashboardPlus",
#     "ggplot2", "ragg", "thematic", "colorspace",
#     "reactable", "reactablefmtr",
#     "data.table", "rlang", "glue",
#     "dplyr","forcats","lubridate",
#     message = FALSE
# )
# Above package loading is not compatible with shinyapps/.io dependency handling (packrat)
library(shiny)
library(shinyWidgets)
library(shinydashboard)
library(shinydashboardPlus)
library(ggplot2)
library(ragg)
library(thematic)
library(colorspace)
library(reactable)
library(reactablefmtr)
library(data.table)
library(rlang)
library(glue)
library(dplyr)
library(forcats)
library(lubridate)

# Plot themes ----

options(shiny.useragg = TRUE)

thematic_shiny()

font_spec(families = c("Roboto", "Montserrat"))

theme_set(theme_classic())

theme_update(
  plot.title = element_text(family = "Roboto"),
  axis.title = element_text(family = "Montserrat"),
  plot.margin = margin(.05, .02, .05, .02, "npc"),
  plot.title.position = "plot"
)

# Read in data ----

# We performed most data cleaning separately and saved as Rds 

# Alice data note:
# This is offenses & dispositions data that has been cleaned up
# And filtered for offenses with dispositions!!
# Then merged with docket/defendant data
merged <- readRDS('./data/merged_filt_offenses_shiny.Rds')


# Load Alison data
merged.narrow <- readRDS('./data/Docket_Offenses_Merged_Narrowed.Rds')

# Load Roy data
bail_net_change_by_judge <- readRDS('./data/bailnetchangebyjudge.rds')

# Create some other variables that the app uses: ----

options <-
  c(
    "Judge",
    "min_grade",
    "max_grade",
    "statute_description",
    "disposition",
    "disposition_method",
    "sentence_type",
    "Title_Description",
    "Chapter_Description",
    "gender",
    "race",
    "in_select_judges"
  )
# Display options in order of most common
judge_options <-
  na.omit(dplyr::pull(dplyr::count(merged, judge, sort = T), judge))
description_options <-
  na.omit(dplyr::pull(
    dplyr::count(merged, description_clean, sort = T),
    description_clean
  ))
